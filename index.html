<!DOCTYPE html>
<html>

<head>
  <title>Geolocation</title>
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">
  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@300&display=swap" rel="stylesheet">
  <style>
    /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
    #map {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 90%;
    }

    /* Optional: Makes the sample page fill the window. */
    html,
    body {
      height: 100%;
      margin: 0;
      padding: 0;
      font-family: 'Exo', sans-serif;

    }

    #bottomNav {
      position: fixed;
      bottom: 0;
      height: 10%;
      width: 100%;
      background-color: #333333;
      display: flex;
      flex-flow: row nowrap;
    }

    #bottomNav>div {
      height: 100%;
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #ffffff;
    }

    .modal{
      visibility: hidden;
      top: 0;
      left: 0;
      bottom: 10%;
      right: 0;
      position: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      background-color: #ffffff80;
    }
    .modalMenu{
      background-color: #333333;
      position: absolute;
      top: 20px;
      left: 20px;
      right: 20px;
      bottom: 20px;
      color:#ffffff;
      padding: 20px;
    }
    .barContainer{
      width: 100%;
      height: 5px;
      background-color: #555555;
    }
    .bar{
      left: 0;
      height: 100%;
      width: 50%;
      background-color: #587498;
    }
  </style>
</head>

<body>
  <div id="map"></div>
  <div id="bottomNav">
    <div id="searchButton">search</div>
    <div id="findButton" onclick="showFind();" style="background-color: #222222;">find</div>
    <div id="moreButton" onclick="showMore();">more</div>
  </div>
  <div class="modal" id="findModal">
    <div class="modalMenu" id="findMenu">
      <span onclick="hideFind();"><h2>Public toilet</h2></span>
      <p>
      Latitude: <span id="latInfo"></span><br>
      Longitude: <span id="lngInfo"></span></p>

      <p>Cost: <span id="costInfo"></span></p>
      Cleanliness:
      <div class="barContainer"><div id="cleanlinessInfo" class="bar" style="width: 80%;"></div></div><br>

      Smell:
      <div class="barContainer"><div id="smellInfo" class="bar" style="width: 60%;"></div></div><br>

      Amenities:
      <div class="barContainer"><div id="amenitiesInfo" class="bar" style="width: 50%;"></div></div><br>
    </div>
  </div>
  <div class="modal" id="moreModal">
    <div class="modalMenu" id="moreMenu">
      <span onclick="hideMore();">Settings</span>
    </div>
  </div>
  <script>
    data = { "locs": [{ "lat": "64.7510824", "lng": "20.9519385", "cost": "$1", "cleanliness": "70", "smell": "80", "amenities": "50" }, { "lat": "64.7520824", "lng": "20.9730262", "cost": "0", "cleanliness": "40", "smell": "20", "amenities": "30" }] };
    // Note: This example requires that you consent to location sharing when
    // prompted by your browser. If you see the error "The Geolocation service
    // failed.", it means you probably did not give permission for the browser to
    // locate you.
    var map, infoWindow;
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: -34.397, lng: 150.644 },
        disableDefaultUI: true,
        zoomControl: true,
        zoom: 6,
        styles: [
          { elementType: 'geometry', stylers: [{ color: '#242f3e' }] },
          { elementType: 'labels.text.stroke', stylers: [{ color: '#242f3e' }] },
          { elementType: 'labels.text.fill', stylers: [{ color: '#746855' }] },
          {
            featureType: 'administrative.locality',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'poi',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'geometry',
            stylers: [{ color: '#263c3f' }]
          },
          {
            featureType: 'poi.park',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#6b9a76' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry',
            stylers: [{ color: '#38414e' }]
          },
          {
            featureType: 'road',
            elementType: 'geometry.stroke',
            stylers: [{ color: '#212a37' }]
          },
          {
            featureType: 'road',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#9ca5b3' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry',
            stylers: [{ color: '#746855' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'geometry.stroke',
            stylers: [{ color: '#1f2835' }]
          },
          {
            featureType: 'road.highway',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#f3d19c' }]
          },
          {
            featureType: 'transit',
            elementType: 'geometry',
            stylers: [{ color: '#2f3948' }]
          },
          {
            featureType: 'transit.station',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#d59563' }]
          },
          {
            featureType: 'water',
            elementType: 'geometry',
            stylers: [{ color: '#17263c' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.fill',
            stylers: [{ color: '#515c6d' }]
          },
          {
            featureType: 'water',
            elementType: 'labels.text.stroke',
            stylers: [{ color: '#17263c' }]
          }
        ]
      });
      infoWindow = new google.maps.InfoWindow;

      // Try HTML5 geolocation.
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function (position) {
          var pos = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };

          /*infoWindow.setPosition(pos);
          infoWindow.setContent('Location found.');
          infoWindow.open(map);*/

          var image = {
            url: 'toilets_inclusive.png',
            // This marker is 20 pixels wide by 32 pixels high.
            size: new google.maps.Size(32, 37),
            // The origin for this image is (0, 0).
            origin: new google.maps.Point(0, 0),
            // The anchor for this image is the base of the flagpole at (0, 32).
            anchor: new google.maps.Point(16, 37)
          };

          map.setCenter(pos);
          map.setZoom(14);
          var marker = new google.maps.Marker({ position: pos, map: map, title: 'You are here' });
          var infowindow = new google.maps.InfoWindow({
            content: "Here's a toilet"
          });

          var markers = [];
          console.log(data.locs[0]);
          for (i = 0; i < data.locs.length; i++) {
            markers[i] = new google.maps.Marker({ position: { lat: Number(data.locs[i].lat), lng: Number(data.locs[i].lng) }, map: map, icon: image, title: 'Toilet' });
            /*markers[i].addListener('click', function (e) {
              //infowindow.open(map, marker);
              console.log(e.latitude);
              showFind(i);
            });*/
            markers[i].addListener('click', showFind.bind(null, i));
          }

        }, function () {
          handleLocationError(true, infoWindow, map.getCenter());
        });
      } else {
        // Browser doesn't support Geolocation
        handleLocationError(false, infoWindow, map.getCenter());
      }
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
      infoWindow.setPosition(pos);
      infoWindow.setContent(browserHasGeolocation ?
        'Error: The Geolocation service failed.' :
        'Error: Your browser doesn\'t support geolocation.');
      infoWindow.open(map);
    }

    function showFind(mid=100){
      //document.getElementById("debug").textContent=mid;
      document.getElementById("latInfo").textContent=data.locs[mid].lat;
      document.getElementById("lngInfo").textContent=data.locs[mid].lng;
      document.getElementById("costInfo").textContent=data.locs[mid].cost;
      document.getElementById("cleanlinessInfo").style.width = data.locs[mid].cleanliness + "%";
      document.getElementById("smellInfo").style.width = data.locs[mid].smell + "%";
      document.getElementById("amenitiesInfo").style.width = data.locs[mid].amenities + "%";
      document.getElementById("moreModal").style.visibility = "hidden";
      document.getElementById("findModal").style.visibility = "visible";
    }

    function hideFind(){
      document.getElementById("findModal").style.visibility = "hidden";
    }

    function showMore(){
      document.getElementById("findModal").style.visibility = "hidden";
      document.getElementById("moreModal").style.visibility = "visible";
    }

    function hideMore(){
      document.getElementById("moreModal").style.visibility = "hidden";
    }
  </script>
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBQhMKpUkmBY6uCHJ9sERBoCw0OlE9srjI&callback=initMap">
    </script>
</body>

</html>